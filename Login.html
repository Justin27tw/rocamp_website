<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>憲兵指揮部 - 登入</title>
    <link rel="icon" type="image/png" href="/images/Png.png">
    <style>
        /* 基礎樣式與版面調整 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            /* 輕微的灰色背景 */
            padding-top: 80px;
            /* 為 Navbar 留白 */
        }

        /* Navbar 樣式，複製 index.html 以保持一致性 */
        .navbar {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* 輕微陰影 */
        }

        /* 登入卡片置中和樣式 */
        .login-card {
            max-width: 450px;
            /* 卡片最大寬度 */
            padding: 30px;
            margin: auto;
            /* 垂直置中 */
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            /* 更明顯的陰影 */
        }

        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .login-header img {
            max-width: 80px;
            margin-bottom: 10px;
        }

        .login-btn {
            background-color: #007bff;
            border: none;
        }

        .login-btn:hover {
            background-color: #0056b3;
        }

        /* !!! 警告區塊樣式 - 已移除動畫並調整為內縮樣式 !!! */
        .alert-security {
            /* 調整上下的距離 */
            margin-top: 0;
            /* 讓 login-header 的 margin-bottom 生效 */
            margin-bottom: 20px;
            /* 距離下方表單 */

            padding: 20px;
            /* 內部內邊距 */
            border: 4px solid #a00010;
            background-color: #a00000;
            color: #ffffff;
            /* 靜態陰影 */
            border-radius: 8px;
            /* 恢復圓角 */
            font-size: 0.85rem;
            /* 保持字體較小 */
        }

        /* 警告區塊標題 */
        .alert-security h4 {
            font-size: 1.25rem;
            /* 縮小 h4 標題 */
            margin-bottom: 10px;
        }

        /* 警告區塊內文字段落 */
        .alert-security p {
            margin-bottom: 5px !important;
            /* 縮小段落間距 */
        }

        /* 內部關鍵文字強調高對比 (僅限黑名單) */
        .alert-security .highlight {
            color: #ffeb3b;
            /* 亮黃色強調 */
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/images/Png.png" alt="" width="50" height="50" class="d-inline-block align-text-middle">
                <span>ROCA憲兵指揮部</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/index.html">首頁</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            最新資訊
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/notice.html">指揮部公告</a></li>
                            <li><a class="dropdown-item" href="/joinus.html">加入我們</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            認識憲兵
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/mpdept.html">憲兵部門介紹</a></li>
                            <li><a class="dropdown-item" href="/daily.html">日常勤務</a></li>
                            <li><a class="dropdown-item" href="/event.html">活動</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            認識高層
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/CO.html">指揮官</a></li>
                            <li><a class="dropdown-item" href="/DCO.html">副指揮官</a></li>
                            <li><a class="dropdown-item" href="/COS.html">參謀長</a></li>
                            <li><a class="dropdown-item" href="/DCOS.html">副參謀長</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            轄下單位
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/MPDSC.html">勤務支援大隊</a></li>
                            <li><a class="dropdown-item" href="/MPSSC.html">特種勤務大隊</a></li>
                            <li><a class="dropdown-item" href="/MPTC.html">憲兵訓練中心</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            更多資訊
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item"
                                    href="https://sites.google.com/view/law-roca/%E9%A6%96%E9%80%81?authuser=0">法規資料庫</a>
                            </li>
                            <li><a class="dropdown-item"
                                    href="https://sites.google.com/view/roca-584/%E9%A6%96%E9%80%81">陸軍裝甲第五八四旅</a></li>
                            <li><a class="dropdown-item"
                                    href="https://sites.google.com/view/robloxrocaaasfc/%E9%A6%96%E9%80%81">陸軍航空特戰指揮部</a></li>
                            <li><a class="dropdown-item" href="https://sites.google.com/view/roca2022">ROCA官方網站</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="login-card mt-5">
                    <div class="login-header">
                        <img src="/images/Png.png" alt="Logo">
                        <h2 class="h4 fw-bold text-dark mt-2">ROCA憲兵內部管理系統</h2>
                        <p class="text-muted">忘記密碼請與副指揮官Justin_chiu27聯絡</p>
                    </div>

                    <div class="alert alert-security fw-bold text-center" role="alert">
                        <h4 class="fa fa-exclamation-triangle fa-lg text-white fw-bolder">
                            警告！嚴禁公開帳號密碼
                        </h4>
                        <p class="mb-1 fw-bold">
                            <strong>憲兵內部系統非相關官兵，不得登入。</strong>
                        </p>
                        <p class="mb-0 fw-bolder">
                            <strong>不遵守將依懲處，並列入 "中華民國憲兵"<span class="highlight">永久黑名單</span>！</strong>
                        </p>
                    </div>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="robloxNameInput" class="form-label fw-bold">帳號</label>
                            <input type="text" class="form-control" id="robloxNameInput" required
                                placeholder="請輸入您的帳號(區分大小寫)">
                        </div>
                        <div class="mb-4">
                            <label for="passwordInput" class="form-label fw-bold">密碼</label>
                            <input type="password" class="form-control" id="passwordInput" required
                                placeholder="請輸入您的密碼">
                        </div>
                        <div class="text-center mt-3">
                            <a href="/joinus.html" class="text-secondary small">還不是憲兵成員？了解如何加入我們</a>
                        </div>
                        <br>
                        <button type="submit" class="btn login-btn text-white w-100 fw-bold">
                            <i class="fa fa-sign-in me-2"></i> 登入Login
                        </button>
                    </form>

                    <div id="message" class="mt-3">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('loginForm');
        const robloxNameInput = document.getElementById('robloxNameInput');
        const passwordInput = document.getElementById('passwordInput');
        const messageElement = document.getElementById('message');

        form.addEventListener('submit', handleLogin);

        // 簡單的訊息提示功能 (用於顯示登入結果)
        function alertMessage(message, type = 'info') {
            messageElement.className = `mt-3 alert alert-${type}`;
            messageElement.innerHTML = `<i class="fa fa-info-circle me-2"></i> ${message}`;
        }

        // 處理登入邏輯：透過 Fetch API 發送請求到後端
        function handleLogin(event) {
            event.preventDefault(); // 阻止表單的默認提交行為

            const robloxName = robloxNameInput.value.trim();
            const password = passwordInput.value.trim();

            // 清空舊訊息
            messageElement.innerHTML = '';
            messageElement.className = 'mt-3';

            // 檢查輸入是否為空
            if (!robloxName || !password) {
                alertMessage('請輸入完整的帳號和密碼。', 'danger');
                return;
            }

            // 發送 POST 請求到後端 API 進行驗證
            fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    robloxName: robloxName,
                    password: password
                }),
            })
                .then(response => {
                    if (!response.ok) {
                        // 處理 HTTP 錯誤狀態 (例如 401 Unauthorized, 500 Internal Server Error)
                        throw new Error(`HTTP Error: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // 登入成功：後端回傳 success: true 和使用者資訊
                        alertMessage(`登入成功！歡迎回來，${data.robloxName}！`, 'success');

                        // 將必要的資訊 (帳號和職位) 儲存到本地儲存
                        const userData = {
                            robloxName: data.robloxName, // 來自後端
                            rank: data.position            // 來自後端
                        };
                        localStorage.setItem('loggedInUser', JSON.stringify(userData));

                        // 導向系統首頁
                        setTimeout(() => {
                            window.location.href = '/MPHome.html';
                        }, 1000);

                    } else {
                        // 登入失敗：後端回傳 success: false 和錯誤訊息
                        alertMessage(`登入失敗：${data.message || '帳號或密碼錯誤。'}`, 'danger');
                    }
                })
                .catch(error => {
                    console.error("連線錯誤:", error);
                    alertMessage('連線錯誤或伺服器未回應，請聯繫管理員。', 'danger');
                });
        }
    </script>

</body>

</html>